{% meta %}
    tags: [packages, analysis]
    title: Цикломатическая сложность
{% endmeta %}

{% mark body %}
Давече Гарри Вильсон <a href="http://gdub.wordpress.com/2006/07/09/cyclomatic-complexity-of-django/">писал</a> о <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity">цикломатической сложности</a> кода <a href="http://www.djangoproject.com/">Django</a>

Мне показалось это интересным, и я получил статистику по пакетам, установленным у меня.


<!--more-->

top20 выглядит так:
<table>
<caption><strong>Цикломатическая сложность</strong></caption>
<tbody>
<tr>
<td><strong>№</strong></td>
<td><strong>Пакет</strong></td>
<td><strong>Наиболее "сложная" функция/метод</strong></td>
<td><strong>Сложность</strong></td>
</tr>
	<tr>
		<td>1</td>
		<td><a href="http://wxglade.sourceforge.net/">wxglade-0.3.5</a></td>
		<td>codegen.cpp_codegen.add_class</td>
		<td>87</td>
	</tr>
	<tr>
		<td>2</td>
		<td><a href="http://www.amk.ca/python/code/crypto">crypto-2.0.1</a></td>
		<td>Util.test.TestBlockModules</td>
		<td>84</td>
	</tr>
	<tr>
		<td>3</td>
		<td><a href="http://moinmoin.wikiwikiweb.de/">moinmoin-1.5.3</a></td>
		<td>userform.UserSettingsHandler.handleData</td>
		<td>81</td>
	</tr>
	<tr>
		<td>4</td>
		<td><a href="http://ipython.scipy.org/">ipython-0.7.1</a></td>
		<td>ipmaker.make_IPython</td>
		<td>62</td>
	</tr>
	<tr>
		<td>5</td>
		<td><a href="http://wxglade.sourceforge.net/">wxglade-0.3.5</a></td>
		<td>codegen.pl_codegen.add_class</td>
		<td>57</td>
	</tr>
	<tr>
		<td>6</td>
		<td><a href="http://www.wxpython.org/">wxpython-2.6.1.2</a></td>
		<td>wx.lib.ogl._composit.Constraint.Evaluate</td>
		<td>55</td>
	</tr>
	<tr>
		<td>7</td>
		<td><a href="http://www.wxpython.org/">wxpython-2.6.1.2</a></td>
		<td>wx.lib.masked.numctrl.NumCtrl.SetParameters</td>
		<td>55</td>
	</tr>
	<tr>
		<td>8</td>
		<td><a href="http://www.dnspython.org/">dnspython-1.3.4</a></td>
		<td>tokenizer.Tokenizer.get</td>
		<td>51</td>
	</tr>
	<tr>
		<td>9</td>
		<td><a href="http://wwwsearch.sourceforge.net/ClientForm/">clientform-0.2.0.99</a></td>
		<td>ClientForm.HTMLForm._find_control</td>
		<td>51</td>
	</tr>
	<tr>
		<td>10</td>
		<td><a href="http://dabodev.com/">dabo-0.5</a></td>
		<td>lib.reportWriter.ReportWriter.draw</td>
		<td>49</td>
	</tr>
	<tr>
		<td>11</td>
		<td><a href="http://www.wxpython.org/">wxpython-2.6.1.2</a></td>
		<td>wx.lib.masked.maskededit.MaskedEditMixin._Undo</td>
		<td>47</td>
	</tr>
	<tr>
		<td>12</td>
		<td><a href="http://moinmoin.wikiwikiweb.de/">moinmoin-1.5.3</a></td>
		<td>macro.Include.execute</td>
		<td>46</td>
	</tr>
	<tr>
		<td>13</td>
		<td><a href="http://www.wxpython.org/">wxpython-2.6.1.2</a></td>
		<td>wx.lib.masked.maskededit.MaskedEditMixin.SetCtrlParameters</td>
		<td>45</td>
	</tr>
	<tr>
		<td>14</td>
		<td><a href="http://twistedmatrix.com/">twisted-2.4.0</a></td>
		<td>python.rebuild.rebuild</td>
		<td>43</td>
	</tr>
	<tr>
		<td>15</td>
		<td><a href="http://python-xlib.sourceforge.net/">xlib-0.12</a></td>
		<td>protocol.display.Display.send_and_recv</td>
		<td>42</td>
	</tr>
	<tr>
		<td>16</td>
		<td><a href="http://www.wxpython.org/">wxpython-2.6.1.2</a></td>
		<td>wx.lib.masked.maskededit.MaskedEditMixin._OnChar</td>
		<td>42</td>
	</tr>
	<tr>
		<td>17</td>
		<td><a href="http://www.egenix.com/files/python/eGenix-mx-Extensions.html#mxTextTools">mxtexttools-2.0.6</a></td>
		<td>Misc.ConfigFile.ConfigFile.read</td>
		<td>42</td>
	</tr>
	<tr>
		<td>18</td>
		<td><a href="http://moinmoin.wikiwikiweb.de/">moinmoin-1.5.3</a></td>
		<td>Page.Page.send_page</td>
		<td>42</td>
	</tr>
	<tr>
		<td>19</td>
		<td><a href="http://wwwsearch.sourceforge.net/ClientCookie/">clientcookie-1.1.1</a></td>
		<td>_ClientCookie.bool</td>
		<td>42</td>
	</tr>
	<tr>
		<td>20</td>
		<td><a href="http://www.bittornado.com/">bittornado-0.3.13</a></td>
		<td>parsedir.parsedir</td>
		<td>42</td>
	</tr>
</tbody>
</table>

При оценке сложности возникли проблемы (по, видимому, связанные с размером файла) со следующими файлами:
<ul>
<li>libxml2.py (пакет <a href="http://xmlsoft.org/python.html">libxml2-2.6.23</a>), 332 кб, 8989 строк;</li>
<li>wx-2.6/wx/_controls.py (пакет <a href="http://www.wxpython.org/">wxpython-2.6.1.2</a>), 260 кб, 6487 строк;</li>
<li>wx-2.6/wx/_core.py (пакет <a href="http://www.wxpython.org/">wxpython-2.6.1.2</a>), 480 кб, 13415 строк;</li>
<li>wx-2.6/wx/_misc.py (пакет <a href="http://www.wxpython.org/">wxpython-2.6.1.2</a>), 220 кб, 6090 строк;</li>
<li>wx-2.6/wx/_windows.py (пакет <a href="http://www.wxpython.org/">wxpython-2.6.1.2</a>), 194 кб, 5039 строк.</li>
</ul>

Напомню, что сложность больше 50 означает очень высокий риск и практически не тестируемый код. И по статистике видно, что первый кандидат на редизайн - wxPython. У него явно наблюдаются проблемы с избыточной сложностью.

Потестировал свой код (в большинстве своем - мелкие библиотеки/скрипты), который был под рукой, оказалось большинство кода укладывается в 10-12, лишь малая часть 13-15.
{% endmark %}
