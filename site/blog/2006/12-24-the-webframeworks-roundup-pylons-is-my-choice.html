{% meta %}
    tags: [pylons, reviews]
    title: Выбор веб-фреймворка: мое решение - Pylons
{% endmeta %}

{% mark body %}
<p>Напомню тему разговора: выбираем инструмент для веб-интерфейса Twisted-сервиса. <a href="http://www.pyobject.ru/blog/post/the-webframeworks-roundup-django-the-calibration-point/">Django</a> и <a href="http://gorod-omsk.ru/blog/pythy/2006/12/12/the-webframeworks-roundup-unadorned-nevow/">Nevow</a> уже рассмотрены, теперь очередь Pylons.
</p>

<!--more-->

<ul>
 <li>
     Самоопределение: a lightweight web framework emphasizing flexibility and rapid development
 </li>
 <li>
     Сайт: <a href="http://www.pylonshq.com">http://www.pylonshq.com</a>
 </li>
 <li>
     Лицензия: BSD
 </li>
 <li>
     Текущая версия: 0.9.3
 </li>
 <li>
     Используемая мной версия: 0.9.3
 </li>
 <li>
     Установка: setuptools (egg)
 </li>
 <li>
     Зависимости: <a href="http://routes.groovie.org/">Routes</a>, <a href="http://pylonshq.com/WebHelpers/">WebHelpers</a>, <a href="http://beaker.groovie.org/">Beaker</a>, <a href="http://pythonpaste.org/">Paste</a>, <a href="http://pythonpaste.org/deploy/">PasteDeploy</a>, <a href="http://pythonpaste.org/script/">PasteScript</a>, <a href="http://www.myghty.org/">Myghty</a>, <a href="http://formencode.org/">FormEncode</a>, <a href="http://undefined.org/python/">simplejson</a>, <a href="http://somethingaboutorange.com/mrl/projects/nose/">nose</a>
 </li>
 <li>
     ORM/DB: отсутствует, рекомендуется <a href="http://www.sqlobject.org/">SQLObject</a>, возможно использование <a href="http://www.sqlalchemy.org/">SQLAlchemy</a>
 </li>
 <li>
     Шаблоны: <a href="http://www.myghty.org">Myghty</a>, возможно использование <a href="http://kid-templating.org/">Kid</a>, <a href="http://genshi.edgewall.org/">Genshi</a> и др.
 </li>
 <li>
     Обработка форм: <a href="http://formencode.org/">FormEncode</a>, <a href="http://toscawidgets.org/">ToscaWidgets</a>
 </li>
 <li>
     Роутинг: <a href="http://routes.groovie.org/">Routes</a>
 </li>
 <li>
     Пакетирование приложения: egg
 </li>
 <li>
     Методы развертывания: WSGI
 </li>
</ul>

<h2>Предыстория</h2>
<p>Прежде всего меня привлек блог <a href="http://www.groovie.org">Groovie</a> автора Pylons Бена Бангерта. Статьи, которые подтолкнули меня к изучению Pylons:
</p>
<ul>
 <li>
     <a href="http://www.groovie.org/articles/2005/08/08/porting-routes-from-rails">Porting Routes from Rails</a> - пояснение, зачем и почему портирован Routes с Ruby на Python.
 </li>
 <li>
     <a href="http://groovie.org/articles/2005/09/30/best-of-breed-controllers-for-mvc-web-frameworks">Best of breed Controllers for MVC web frameworks</a> - великолепный обзор способов диспечеризации URL-object (явный, неявный, программный) и реализации контроллеров (исполняемый объект, метод класса, функция). По этой классификации рассматриваются <a href="http://aquarium.sourceforge.net/">Aquarium</a>, <a href="http://www.pythonweb.org/doc/bricks.doc.html">Bricks</a>, <a href="http://www.cherrypy.org/">CherryPy</a>, <a href="http://www.djangoproject.com/">Django</a>, <a href="http://www.myghty.org/">Myghty</a>, <a href="http://www.rubyonrails.com/">Rails</a>.
 </li>
 <li>
     <a href="http://www.groovie.org/articles/2005/10/13/python-web-framework-niches">Python Web Framework Niches</a> - статья о том, что каждый фреймворк (говорится о Django и TurboGears) имеет свою нишу, и не надо устраивать битву Горцев (должен остаться только один).
 </li>
 <li>
     <a href="http://www.groovie.org/articles/2005/11/14/project-code-re-use-turbogears-and-django">Project/Code Re-Use, TurboGears and Django</a> - небольшой анализ TurboGears и Django в контексте реиспользования кода
 </li>
 <li>
     <a href="http://www.groovie.org/articles/2006/02/23/ingredients-to-the-pylons-python-web-framework">Ingredients to the Pylons Python Web Framework</a> - замечательная статья, объясняющая из каких &quot;кирпичиков&quot; построен Pylons. По ходу дела объясняется, почему выбраны именно эти. &quot;Раствором&quot;, который скрепляет &quot;кирпичики&quot;, служит WSGI. 
 </li>
</ul>
<p>Как видно, Бен перед тем как писать свой собственный фреймворк, достаточно глубоко изучил уже существующие решения. Мне это понравилось. Он не стал изобретать велосипед, а использовал уже готовые компоненты, причем для связи взял стандартный протокол. Мне это тоже понравилось. Мельком глянул документацию и примеры, прошел туториал. Стиль приложения мне понравился. После этого я добавил Pylons как вариант платформы, на которой буду писать будущий проект.
</p>

<h2>Тестовое приложение на Pylons</h2>
<p>Неожиданностей не было. Всё получилось легко и непринужденно. Сам процесс доставил мне удовольствие. Немного не понравились Mygthy-шаблоны. Думаю, что я буду использовать другие (Pylons позволяет это).
</p>

<h3>Количество сгенерированного кода</h3>
<p>Для создания &quot;рыбы&quot; Pylons-проекта служит команда <code>paster create</code>:
</p>

<pre><code>pythy@axcel:~/tmp/py$ paster create --template=pylons pylonsex
</code></pre><p>Поначалу меня смутило количество сгенерированного кода, я даже думал использовать минималистский вариант -- шаблон <code>pylons_minimal</code>. Меня не пугали небольшие расхождения с документацией (которая ориентирована на шаблон <code>pylons</code>), но почти написав приложение, я понял, что прихожу к стандартному шаблону, так что есть смысл использовать его.
</p>
<p>Что же имеем в &quot;рыбе&quot;:
</p>
<pre><code>PylonsFish
|-- PylonsFish.egg-info                                 # Каталог с метаданными для setuptools
|   |-- PKG-INFO                                        # Информация о пакете
|   |-- SOURCES.txt                                     # Список файлов, которые необходимо включить в пакет
|   |-- dependency_links.txt                            # URL'ы, где искать зависимости пакета
|   |-- entry_points.txt                                # Точки входа, какие плагины реализует пакет
|   |-- paste_deploy_config.ini_tmpl                    # Шаблон для настроек paste.deploy
|   |-- paster_plugins.txt                              # Какие paste-плагины используются
|   |-- requires.txt                                    # Зависимости пакета (Pylons&gt;=0.9.3)
|   `-- top_level.txt                                   # Имя Python-пакета (т.е. pylonsfish)
|-- README.txt                                          # Минимальный readme
|-- development.ini                                     # Paste-настройки для окружения разработчика
|-- pylonsfish                                          # Собственно само приложение
|   |-- __init__.py                                     # Мини-загрузчик WSGI-приложения
|   |-- config                                          # Настройки приложения
|   |   |-- __init__.py                                 # -
|   |   |-- environment.py                              # Основные переменные окружения (где находятся контроллеры, шаблоны, и т.д.)
|   |   |-- middleware.py                               # Используемые WSGI middleware
|   |   `-- routing.py                                  # Управление URL'ами
|   |-- controllers                                     # Контроллеры
|   |   |-- __init__.py                                 # -
|   |   |-- error.py                                    # Контроллер для управления ошибками (404, 500 и т.д.)
|   |   `-- template.py                                 # Контроллер для прямой отрисовки шаблонов
|   |-- docs                                            # Документация к проекту
|   |   `-- index.txt                                   # Краткая информация, как компилировать документацию в html
|   |-- i18n                                            # Каталог для переводов
|   |   `-- __init__.py                                 # -
|   |-- lib                                             # Каталог для проект-специфичных библиотек
|   |   |-- __init__.py                                 # -
|   |   |-- app_globals.py                              # Глобальные объекты
|   |   |-- base.py                                     # Базовый набор для контроллера
|   |   `-- helpers.py                                  # Помощники (всё, что в этом модуле доступно через h-объект)
|   |-- models                                          # Модели
|   |   `-- __init__.py                                 # заглушка для SQLObject
|   |-- public                                          # Статический контент
|   |   `-- index.html                                  # Мини-помощь
|   |-- templates                                       # Каталог для шаблонов
|   |   `-- autohandler                                 # Базовый Mygthy-шаблон
|   |-- tests                                           # Тесты для приложения
|   |   |-- __init__.py                                 # Подготовка тестового окружения
|   |   |-- functional                                  # Функциональные тесты (тесты контроллеров)
|   |   |   `-- __init__.py                             # -
|   |   `-- test_models.py                              # Тесты моделей
|   `-- websetup.py                                     # Дополнительные настройки
|-- setup.cfg                                           # Настройки setuptools
`-- setup.py                                            # setup.py для пакета/egg
</code></pre><p>Буквально на днях <a href="http://maxischenko.in.ua/blog/">Макс Ищенко</a> <a href="http://groups-beta.google.com/group/pylons-discuss/browse_thread/thread/494ce5d62f7d1643/f8396720da2260e3">задал вопрос</a> о размере &quot;рыбы&quot;. Разработчики пояснили свою позицию: они предпочитают выносить часть кода в приложение, обходясь без черной магии в самом фреймворке и предоставляя разработчику модифицировать этот код как ему удобней.

</p>
<p>Напомню URL'ы, которые нужно обрабатывать:
</p>
<ul>
 <li>
     <code>/</code> - базовый URL
 </li>
 <li>
     <code>/forms</code> - пример рыботы с формами
 </li>
 <li>
     <code>/selfcode</code> - код приложения
 </li>
 <li>
     <code>/dynamic</code> - псевдо-динамическая страница
 </li>
</ul>

<p>Я не стал, как в Django, назначать каждому URL'у отдельный контроллер, а просто в рамках одного контроллера назначил URL'ы различным действиям (action):
</p>
<pre><code>map.connect(':action', controller='simple')
</code></pre><p>И создал контроллер <code>simple</code>:
</p>
<pre><code>pythy@axcel:~/tmp/py/pylonsex/pylonsex$ paster controller simple
</code></pre><p>Потом в <code>controllers/simple.py</code> добавил необходимые мне действия. По стилю Pylons-контроллеры весьма похожи на Django-виды, так что я достаточно быстро всё сделал. В отличии от Nevow, мне без особых сложностей удалось воспроизвести один-к-одному поведение тестового Django-приложения (это касается отображения формы и ее ошибок). Я не сказал бы, что в восторге от Myghty-шаблонов, но никаких особых неудобств они не доставляют.
</p>
<p>При создании приложения я использовал следующую документацию:
</p>
<ul>
 <li>
     <a href="http://pylonshq.com/docs/0.9.3/getting_started.html">Getting started</a>
 </li>
 <li>
     <a href="http://pylonshq.com/docs/0.9.3/form_handling.html">Form handling</a>
 </li>
</ul>

<h2>Итог</h2>

<p>Pylons мне понравился. При работе с ним я получаю удовольствие. В итоге, для себя я решил: если в проект вписывается Django-админка, то я использую Django; если она не нужна - я использую Pylons. Так что открыта новая категория: <a href="http://gorod-omsk.ru/blog/pythy/tag/pylons/">Pylons</a> и продолжение обязательно будет...
</p>
<p>Код приложения, как всегда, на <a href="http://pythy.googlecode.com/svn/trunk/webframeworks/pylonsex/">google.code.com</a>.
</p>
{% endmark %}
