{% meta %}
    tags: [wsgi, paste, docs]
    title: PasteDeploy: ликбез для пользователей
{% endmeta %}

{% mark body %}
<p>Продолжаем <a href="http://www.pyobject.ru/blog/post/wsgi-paste">тему Paste</a>. 
Сегодня разговор о <a href="http://pythonpaste.org/deploy/">PasteDeploy</a>.</p>

<p>Вначале я просто думал перевести документацию по PasteDeploy, да что-то она какая-то замороченная, поэтому я попытаюсь изложить чуть попроще, а желающие могуть оценить <a href="http://pythonpaste.org/deploy/">оригинальный документ</a>. </p>

<h2>Зачем нужен PasteScript</h2>

<p>Он нужен для одной единственной цели - дать способ конфигурировать WSGI-приложения, получая на выходе настроенное приложение в виде WSGI-приложения. Каламбур.</p>

<p>Еще раз. У вас есть некое WSGI-приложение. И необходима система конфигурирования. С ходу возникает идея просто хранить конфиг в отдельном модуле. Так, например, делает Django. Правда, он не использует явно модуль конфига, а подгружает его в свою настроечную систему, но не суть важно. Однако с этим подходом возникают проблемы, как только у вас возникнет желание компоновать WSGI-приложения в одном сайте <em>с разными настройками</em>. Например, Django в рамках одного проекта без специальных ухищрений не даст вам возможности использовать для блога одну БД, а для форума - другую. PasteDeploy худо-бедно (худо-бедно, потому что Ян Бикинг сделал упор на гибкость несколько в ущерб простоте, да и документация несколько хромает) решает эту проблему. Он дает возможность thread-safely настраивать WSGI-приложения. </p>

<!--more-->
<p>Данная статья расчитана на пользователей PasteDeploy, т.е. у вас уже есть приложение. Что вам нужно знать, чтобы минимально настроить его:</p>

<h2>Необходимый минимум</h2>

<p>Конфиг Paste это <a href="http://ru.wikipedia.org/wiki/Ini">INI-подобный</a> файл. Все настройки разбиты по секциям (их еще по-другому называют разделами). У PasteDeploy есть схема их именования: <code>[тип:название]</code>. Если имя секции не вписывается в схему, секция игнорируется (к примеру, это позволяет совершить финт ушами, когда один и тот же конфиг управляет и PasteDeploy, и <a href="http://docs.python.org/lib/logging-config-fileformat.html">logging</a>). Имена разделов чуствительны к регистру.</p>

<p>Для минимума хватит два типа: <code>app</code> и <code>server</code>. Соответственно, первый описывает приложения, второй - сервера. Если у вас всего одно приложение и один сервер, то их название должно быть <code>main</code>. Таким образом, в простейшем случае у вас один раздел <code>[app:main]</code>, который может дополнятся <code>[server:main]</code>. А, еще, глобальные настройки, общие для всех приложений и серверов находятся в разделе <code>[DEFAULT]</code>.</p>

<p>Ок. Поехали дальше. Приложение или сервер должны инициировать какой-нибудь Py-код. Наиболее просто работать с eggs. Со специально подготовленными точками входа... но об этом должен думать разработчик приложения ;) Итак, в разделе сервера или приложения вы указываете какое яйцо использовать:</p>

<pre><code class="no-highlight">[app:main]
use = egg:PasteDeploySimplestExample
</code></pre>

<p>После названия яйца можно явно указать точку входа, разделяя их <code>#</code> (не путайте с комментариями):</p>

<pre><code class="no-highlight">[server:main]
use = egg:PasteDeploySimplestExample#wsgiref
</code></pre>

<p>Таким образом, простейший конфиг выглядит примерно так:</p>

<pre><code class="no-highlight">[DEFAULT]
author = Yury Yurevich
description = The first config for PasteDeploy-enabled app

[app:main]
use = egg:PasteDeploySimplestExample
# однострочное значение
param_foo = It works!
# многострочное значение
param_bar = Multiline is 
    supported. Just 
    indent it.
# boolean значение, можно использовать 1/0, True/False, true/false
param_baz = 1

[server:main]
use = egg:PasteDeploySimplestExample#wsgiref
# для большинства серверов актуально как миниму два параметра:
# хост
host = 127.0.0.1
# и порт
port = 8080
</code></pre>

<p>Сохраняем его в example.ini, и запускаем при помощи <a href="http://pythonpaste.org/script/">PasteScript</a>: <code>paster serve example.ini</code>.</p>

<p>Зная это, вы сможете по-минимуму настраивать приложения. </p>

<p>Играйтесь с PasteDeploySimplestExample, код - как обычно, на <a href="http://pythy.googlecode.com/svn/trunk/paste_deploy/PasteDeploySimplestExample/">code.google.com</a>.</p>

<p>Продолжение следует...</p>
{% endmark %}
