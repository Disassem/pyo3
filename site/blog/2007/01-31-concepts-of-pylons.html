{% meta %}
    tags: [reviews, retellings, django, pylons, articles, turbogears]
    title: Концепции Pylons
{% endmeta %}

{% mark body %}
<p>Не бесспорная <a href="http://workaround.org/concepts-of-pylons.html">статья Кристофа Хааса</a>. Тем не менее, достаточно интересна. Мне приглянулась описанием Django, TurboGears и Pylons. По крайней мере, у меня схожие ощущения от Django и Pylons.
</p>
<p>Обсуждение статьи (на английском) можете <a href="http://groups.google.com/group/pylons-discuss/browse_thread/thread/6d8efb492bfaebe4/d72ba75921d91ccf">посмотреть в группе pylons-discuss</a>
</p>
<p>Перед прочтением советую ознакомиться с <a href="http://www.pyobject.ru/blog/post/the-webframeworks-roundup-pylons-is-my-choice/">кратким обзором Pylons</a>.
</p>
<p>Далее - перевод.</p>
   
<!--more-->


<p>Добро пожаловать в Pylons (Пилоны). Скорее всего вы здесь, потому что желаете написать веб приложение и ищите способ сделать это проще. Возможно, вы раньше писали CGI скрипты, или использовали PHP. Что ж, Pylons - это веб фреймворк, который возможно работает несколько иначе, чем вы привыкли. Если вы использовали другие фреймворки: Django, TurboGears или Ruby on Rails, то вы понимаете о чем я. Это введение поможет понять вам для чего Pylons нужны и как выглядит разработка с использованием Pylons.
</p>

<h2>Что такое фреймворк</h2>
<p>Как сказано выше, Pylons - это веб фреймворк. Вообще говоря, фреймворк - это набор компонент (таких как другие программы, библиотеки или даже скриптовые языки), которые работают вместе для формирования базовой основы вашего приложения. Когда вы пишите веб приложение, вам зачастую нужны некоторые общие инструменты:
</p>
<ul>
 <li>
     нечто, что генерирует HTML;
 </li>
 <li>
     нечто, что разбирает аргументы, переданные по HTTP;
 </li>
 <li>
     нечто общающееся с базой данных;
 </li>
 <li>
     нечто содержащее логику вашего приложения;
 </li>
 <li>
     нечто управляющее пользовательскими аккаунтами;
 </li>
 <li>
     нечто сохраняющее промежуточные данные (напр. сессии, основанные на куках).
 </li>
</ul>
<p>Если вы писали веб приложение (даже если это был простейший скрипт, выводящий &quot;Hello, World!&quot;), то значит вы писали бОльшую часть вещей, описанных выше, самостоятельно. Вы, возможно, просто использовали <code>print</code> для создания HTML и не заботились о сложных системах шаблонов. Это хорошо работает с простыми приложениями, но программы имеют тенденцию расти, и без хороших концепций, они становятся проблемными в обслуживании и поддержке. Иными словами, через некоторое время у вас будет куча программ, которые выводят HTML подобным образом. Уверен, вы можете перенести некоторые общие части в модули и использовать их из всех ваших программ. Но в действительности, вы ищите решения для сверхтипичных задач, возникающих в каждом веб приложении.
</p>

<p>Так что некоторые продвинутые люди потратили свое свободное время для создания компонент, которые &quot;закрывают&quot; эти ежедневные задачи. Например, существует Python пакет Mako, который работает с созданием HTML - т.е. является системой шаблонов. Используя Mako, вы создаете файл (называемый шаблоном), который содержит целиком вашу HTML страницу. Но у вас есть возможность добавить Python конструкции прямо в этом файле, в том месте, где вам нужно, а также получить доступ к переменным из других частей вашего приложения. И поскольку эти шаблоны могут использовать друг-друга, то вы имеете возможность легко поменять дизайн вашего сайта, просто изменив базовый шаблон.
</p>
<p>Это просто пример того, как компоненты могут облегчить жизнь программисту. И существует большое количество уже готовых компонент. Это очень хорошая идея - использовать их, вместо того чтобы вручную разбирать каждодневную рутину. А теперь представьте, что у вас несколько полезных компонент и они работают слаженно, вместе. Так вот, веб фреймворки, такие как Pylons, как раз и занимаются этим.
</p>

<h2>Что такое MVC?</h2>
<p>Возможно вы уже сталкивались с аббревиатурой MVC в контексте веб фреймворков. MVC - сокращение от Model-View-Controller (модель, вид/представление, контроллер). Это один из подходов, используемых при разработке ПО. При помощи данного подхода, приложение разбивается на:
</p>
<p>Модели - содержат данные, с которыми работает ваше приложение. Модели не содержат информации о значении этих данных. Часто модель соотносится с таблицами базы данных.
</p>
<p>Виды - отвечают за чтение данных из модели и их отображение пользователю. (В то время как модели и контроллеры имеют точно такие же названия в Pylons, следует отметить что в Pylons виду соответствует шаблон).
</p>
<p>Контроллер - здесь находится логика приложения. Контроллер вызывает виды для отображения данных пользователю, либо получает данные от пользователя и сохраняет их в моделях.

</p>
<p>Возможно вы уже писали программы, которые &quot;общаются&quot; с базой данных, выводят HTML и содержат некоторую логику. Идея MVC в изоляции, так что вы можете менять одну часть не ломая другие.
</p>
<p>(Для более подробного описания см. <a href="http://ru.wikipedia.org/wiki/Model_View_Controller">статью из Википедии</a> )
</p>

<h2>Компоненты Pylons</h2>
<p>Поскольку Pylons состоят из нескольких компонент, то новичку будет непросто понять, как эти компоненты взаимодействуют. Попробую объяснить. Все начинается с Paste.
</p>

<h4>Paste</h4>
<p>Paste - веб сервер и инструмент, помогающий в развертывании вашего приложения. Как видно из <a href="http://pythonpaste.org/script/">paste script</a>, ваш конфигурационный файл <code>development.ini</code> состоит из двух разделов:
</p>
<ul>
 <li>
     <code>[server:main]</code> - этот раздел нужен для самого Paste. В нем описывается, какой IP адрес и какой TCP порт использовать Paste для своего веб сервера. Строка <code>use=</code> ссылается на egg (автоматический способ установки Python пакетов) с Paste.
 </li>

 <li>
     <code>[app:main]</code> - этот раздел описывает настройки вашего приложения.
 </li>
</ul>
<p>В документации к Pylons говорится, что веб сервер с вашим приложением запускается командой <code>paster serve --reload development.ini</code>. Если вы не указываете имя приложения (<code>app:name</code>) в опциях, Paste будет искать приложение <code>main</code>. Вот таким образом он берет <code>[app:main]</code>. После некоторых внутренних операций, Paste загружает ваш <code>config/middleware.py</code> и оттуда запускает <code>make_app</code>. Вы можете изменить эту функцию согласно вашим требованиям.

</p>
<p>Очень много подробностей вы можете увидеть в <a href="http://sluggo.scrapping.cc/python/pylons/pylons-execution.html">Pylons execution analysis</a>.
</p>

<h4>SQLAlchemy</h4>
<p>Большинство веб приложений используют базы данных в качестве хранилища. Вы можете сохранять данные ваших клиентов, статьи, описания для e-shop, в общем, все что угодно. У SQLAlchemy есть пара полезных возможностей:
</p>
<ul>
 <li>
     SQL тулкит
 </li>

 <li>
     ORM (object relational mapper)
 </li>
</ul>
<p>&quot;SQL тулкит&quot; легко объяснить: вы определяете таблицы в базе данных и больше вообще не пишите SQL-запросов. Можно воспринимать SQLAlchemy, как некоторый уровень абстракции. Если вы в приложении используете эту абстракцию, то вы можете поменять СУБД, скажем, с MySQL на PostgreSQL и не беспокоиться о разницах между этими СУБД.
</p>
<p>Гораздо более интересно то, что касается ORM. Вообразите, что вы определяете таблицы базы данных в синтаксисе Python, создавая Python класс. Теперь вы вызываете специальную функцию ,которая магическим образом &quot;склеивает&quot; класс с таблицей. Например:
</p>
<pre><code>Customer.select_by(name='Kennedy')
</code></pre><p>Этот пример выполнит запрос к БД и &quot;вытащит&quot; запись из таблицы, отвечающая вашим клиентам, в которой имя - Kennedy. Ведь это гораздо приятней, чем писать SQL запросы?

</p>
<p>Полную документацию можно найти на <a href="http://www.sqlalchemy.org/docs/">сайте SQLAlchemy</a>.
</p>
<p>К слову говоря, SQLObject - еще один известный SQL тулкит. Ходят слухи, что SQLObject проще и что SQLAlchemy не готов к промышленному использованию (production ready). В действительности, похоже что мало-помалу SQLAlchemy набирает популярность. SQLObject имеет некоторые ограничения (как например, основной ключ должен быть типа integer, хотя это не всегда так). SQLObject несколько менее точен, а его синтаксис странноват.
</p>

<h4>Mygthy</h4>
<p>Это шаблонный движок. Вместо того чтобы вставлять <code>print</code> в код, вы используете шаблоны, который выводят HTML пользователю. Файл шаблона содержит только HTML. И если у вас есть статическая страница, вы просто говорите программе:
</p>
<pre><code>render_response('welcome.myt')
</code></pre><p>и Mygthy загрузит файл <code>templates/welcome.myt</code> и покажет пользователю.

</p>
<p>Это немного скучно. Становится интересно, когда нужно добавить некий Python код в шаблон. Простой пример:
</p>
<pre><code>&lt;html&gt;
&lt;body&gt;
    &lt;h1&gt;Welcome&lt;/h1&gt;
    &lt;p&gt;Today we serve:&lt;/p&gt;

    &lt;ul&gt;
% for meal in ['calzone', 'porkpie', 'pizza']:
        &lt;li&gt;&lt;% meal %&gt;&lt;/li&gt;
% # end of for loop
    &lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>Шаблоны поддерживают некоторые потрясающие вещи. Вы можете использовать переменные, которые определяются в вашем приложении. Вы можете включать другие шаблоны, или наследоваться от них. Подробности см. на <a href="http://www.myghty.org/docs/">сайте Myghty</a>.

</p>
<p>Если вы использовали PHP в таком ключе для вывода HTML вместе с программной логикой, то вам будет это привычно.
</p>

<h4>Routes</h4>
<p>Интересные особенности веб фреймворков в том, что вы контролируете абсолютно все с данными, получаемыми от пользователя. Это включает и управление URLами. Routes позволяет выбирать действие в зависимости от URLа. Например, возьмем такой URL:
</p>
<pre><code>http://pylonshq.com/blog/2007/01
</code></pre><p>Вы можете сказать Routes, чтобы обрабатывал это запрос контроллер<code>blog</code>, получая '2007' как параметр year и '01' как параметр month. В синтаксисе Routes это будет выглядеть так:
</p>
<pre><code>m.connect('blog/:year/:month', controller='blog')
</code></pre><p>Настройка роутинга URLов находится в <code>config/routing.py</code> вашего приложения.

</p>

<h4>WebHelpers</h4>
<p>Даже с использованием вышеописанных компонент, вы будете ловить себя на том, что вновь пишете функции для выполнения каждодневной работы. Пакет WebHelpers содержит такие функции, и вы их можете использовать в Pylons-приложении. Некоторые примеры, что могут WebHelpers:
</p>
<ul>
 <li>
     просто и элегантно управлять элементами AJAX
 </li>

 <li>
     форматировать текст и числа
 </li>

 <li>
     создавать URLы, ссылки, элменты HTML форм
 </li>

 <li>
     создавать RSS-фиды
 </li>
</ul>
<p>Также в WebHelpers содержатся функции, портированные с фреймворка Ruby on Rails. WebHelpers не только помогают сократить время на решении каждодневных скучных задач, но также имеет поддержку скриптов с JavaScript-библиотеки <a href="http://script.aculo.us/">script.aculo.us</a>, которая может быть использована для AJAX или прикольных графических эффектов с целью впечатлить коллег. Чтобы примерно понять как это выглядит - пройдитесь по <a href="http://wiki.script.aculo.us/scriptaculous/show/Demos">wiki.script.aculo.us</a>.

</p>

<h4>Существуют ли другие веб фреймворки?</h4>
<p>Да. Два других, наиболее часто упоминаемых фреймворков, - Django и TurboGears. Нигде нет более-менее честного их сравнения, поскольку все три фреймворка пытаются реализовать (не)cхожую функциональность. И разные программисты могут ожидать разного от инструментов. Но в любом случае,  я попытаюсь сравнить.
</p>
<p><strong>Django</strong> ориентирован на программистов, часто работающих с контентом. Создатели Django - из газетного бизнеса. Они говорят, что их часто просят реализовать некоторые &quot;фишки&quot; на сайте в очень краткое время. Так что они написали свой собственный фреймворк. Django не использует уже готовые компоненты. Даже для доступа к БД (то, что называется ORM) они используют собственное решение. Если у вас требования аналогичны запросам авторов Django, то этот веб фреймворк создан для вас. Но это совсем не значит, что легко будет заменить компонент, который вам не сильно нравится, на нечто другое. Их язык шаблонов не очень &quot;питоничен&quot; (pythonic) - это собственный язык, хотя и очень простой. Весьма приятная возможность фреймворка - автоматический административный интерфейс - при помощи него легко управлять изменять ваши данные. Вдобавок, в этом фреймворке достаточно остроумный способ отображения URLов на функции вашего приложения - при помощи регулярных выражений. AJAX возможен с Django, но не слишком удобен. Далее, в фреймворке есть встроенный  веб сервер, но рекомендуется использовать Apache c mod_python. Одну вещь можно с уверенностью сказать о Django: у них хороший маркетинг :-) Django хорошо документирован, имеет крупное сообщество и, вдобавок, сейчас пишется книга. В целом, Django - фреймворк &quot;don't worry - be happy&quot;, с тесно интегрированными компонентами. Он поможет вам делать свою работу быстрее, если вы не слишком заботитесь о выборе используемых компонент и не ожидаете, что все части будут выглядеть &quot;питонично&quot; (pythonic). И еще - в нем многовато &quot;магии&quot;.

</p>
<p><strong>TurboGears</strong> создан на базе существующих компонент. Веб сервер работает на CherryPy, HTML шаблоны - на Kid, он получает доступ к БД при помощи SQLObject и вдобавок включает в себя MochiKit - JavaScript библиотеку для создания AJAX-приложений. В нем проще чем в Django заменить некоторые компоненты, если они вам не сильно нравятся. Например, вы можете &quot;выбросить&quot; SQLObject и использовать SQLAlchemy вместо него; хотя большинство частей TurboGears не могут похвастаться хорошей поддержкой SQLAlchemy. Схема отображения URLов в TurboGears менее прозрачна. Вы не можете явно сказать, что именно нужно делать с конкретным URLом. Вместо этого вы создаете контроллер с таким же именем, как и первая часть URLа. Так что URLы, которые видит пользователь, менее изящны. Удобная &quot;фишка&quot; TurboGears - это набор веб утилит. Среди них - WidgetBrowser для обзора библиотеки элементов форм, или Catwalk - фронтенд для администрирования БД, подобный автоматической админки Django. TurboGears хорошо документирован и также имеет крупное сообщество. В целом, у TurboGears есть удобные &quot;фишки&quot;, такие как библиотека виджетов или набор качественных инструментов, которые делают жизнь чуть проще. Их документация в некоторых местах не полна и содержит рецепты и примеры, а не справочники. Переход на SQLAlchemy анонсирован публично, но много вещей все еще работают только с SQLObject. TuboGears может быть хорошим выбором для программистов, которых пугает &quot;магия&quot; Django и которым нравятся бОльшая прозрачность.
</p>
<p><strong>Pylons</strong> не новичок, но сообщество у них гораздо меньше чем у Django или TurboGears. Это не означает, что Pylons технически хуже остальных. Уникальность этого фреймворка в минимализме и бОльшей гибкости по сравнению с другими. Вообще говоря, чтобы начать использовать Pylons, достаточно изучить базовые понятия компонент. Далее, нужно понять как эти компоненты управляются из Pylons-приложения. Так что Pylons - это клей между компонентами, с добавлением мощного пакета WebHelpers. Гибкость Pylons означает что вы можете менять компоненты очень легко. Вам не нравится SQLAlchemy? Используйте SQLObject! Вам кажется Myghty избыточным по сравнению с Mako? Используйте Mako! Pylons не связывают по рукам и ногам, но стараются помочь с использованием компонент, отличных от стандартных. Компоненты осмотрительно выбираются из кандидатур, оглядываясь на ошибки других веб фреймворков. Документация к Pylons далека от идеала, и пока еще нет &quot;Pylons Handbook&quot;. Некоторые говорят, что Pylons это Ruby on Rails, написанные на Python.

</p>

<h2>Чем использование веб фреймворка отличается от программирования CGI?</h2>
<p>Много программистов пишут CGI используя скриптовый язык, например как Perl. В первую очередь, в силу поддержки со стороны хостинга. CGI - это программа, которая запускается веб сервером при запросе пользователя конкретного URLа. CGI получает информацию, посылаемую веб браузером (и из некоторых переменных окружения веб сервера) и выводит HTML, отображаемый в браузере. Так что вам как минимум нужен веб сервер, например Apache.
</p>
<p>С веб фреймворком, таким как Pylons, вам не обязательно использовать отдельный веб сервер. Pylons включают в себя веб сервер Paste. Этот подход имеет некоторые преимущества:
</p>
<ul>
 <li>
     вы легко можете разрабатывать приложение на рабочей станции, поскольку вам не требуется дополнительное ПО в виде стороннего веб сервера, например Apache
 </li>

 <li>

     вы практически полностью контролируете поведение веб сервера (например, коды HTTP ошибок)
 </li>

 <li>
     вы можете использовать гибкие схемы URLов. В CGI URLы всегда отражают имя CGI-скрипта. С Pylons вы можете определять действия на URL по шаблону
 </li>

 <li>
     веб сервер держит ваше приложение в памяти, целиком. Когда вы используете CGI, веб сервер при каждом запросе заново запускает интерпретатор вашего скрипта, так что есть издержки, особенно ощутимые на загруженных веб серверах.
 </li>
</ul>

<h2>Как лучше всего начать работать с Pylons?</h2>
<p>Поскольку Pylons - это компоненты, собранные и склеенные воедино, так что нет особого резона писать Pylons Handbook, который будет повторять уже существующую документацию этих компонент. Документация, поставляемая вместе с Pylons, покрывает основные ключевые моменты использования этих компонент, содержит примеры и туториалы. Так что не пугайтесь, если вас отошлют на другой сайт.
</p>
<p>Нет необходимости знать все компоненты &quot;на зубок&quot;, но чтобы правильно использовать Pylons, вам нужно понимать их основы. В дополнение к введению в Pylons <a href="http://pylonshq.com/docs/0.9.4.1/getting_started.html">Getting started</a> и туториала <a href="http://pylonshq.com/docs/0.9.4.1/quick_wiki.html">QuckWiki</a>, которые вы можете найти в <a href="http://pylonshq.com/docs">документации к Pylons</a>, желательно прочесть краткие введения в компоненты Pylons:
</p>
<ul>
 <li>

     <a href="http://www.sqlalchemy.org/docs/tutorial.myt">SQLAlchemy</a> - SQL тулкит и ORM
 </li>

 <li>
     <a href="http://www.myghty.org/docs/embedding.myt">Myghty</a> - шаблоны
 </li>

 <li>
     <a href="http://www.makotemplates.org/docs/">Mako</a> - шаблоны, альтернатива Myghty
 </li>

 <li>
     <a href="http://pylonshq.com/WebHelpers/module-index.html">WebHelpers</a> - набор Python-инструментов
 </li>

 <li>
     <a href="http://routes.groovie.org/manual.html">Routes</a> - как URLы ставятся в соответствие с контроллерами
 </li>
</ul>

<p>Этот материал поможет вам в краткие сроки познакомиться с Pylons. Удачи в вашем первом проекте на Pylons!
</p>
{% endmark %}
